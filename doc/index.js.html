<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*jshint node:true */
/*global beforeEach, afterEach, describe, expect, it, spyOn, xdescribe, xit */
'use strict';

var path = require("path");
var _ = require("lodash");
var fs = require("fs");

var injectionTemplates = {
    css: '&lt;link rel="stylesheet" type="text/css" href="&lt;%= file %>">',
    js: '&lt;script src="&lt;%= file %>">&lt;/script>',
    scss: '@import "&lt;%= file %>";'
};

var commentStyles = {
    html: "&lt;!-- &lt;%= marker %>:&lt;%= type %> -->",
    scss: "// &lt;%= marker %>:&lt;%= type %>"
};

var defaults = {
    templateType: "html",
    commentStyle: ""
};


/**
 * Creates a new CaptainHook instance
 * @class CaptainHook
 *
 * @param  {string} template Template with comment tags used for injection
 * @param  {string} [templateType="html"] Template type
 * @param  {object} customInjectionTemplates Custom injection templates
 * @return {CaptainHook} Instance of CaptainHook
 */
function CaptainHook(template, templateType, customInjectionTemplates) {

    this.template = template;
    this.templateType = templateType || "html";
    this.commentStyle = commentStyles[this.templateType];

    if(customInjectionTemplates) {
        this.injectionTemplates = _.defaults(customInjectionTemplates, injectionTemplates);
    } else {
        this.injectionTemplates = injectionTemplates;
    }

}


/**
 * CaptainHook.prototype.inject - Inject a group of files into the instance's template
 * @memberof CaptainHook#
 *
 * @param  {string} blockID        ID of the comment block to inject into
 * @param  {string[]} injections   Array of lines to inject
 * @param  {string} injectTemplate Template used for each injected line
 * @return {string}              Instance's template
 */
CaptainHook.prototype.inject = function (blockID, injections, injectTemplate) {
    this.commentTags = this.generateCommentTags(blockID);

    var originalTags = this.getBlockContents(this.commentTags);
    var indexes = this.getBlockIndexes(this.commentTags);

    var indentation = this.template.substring(this.template.substring(0, indexes.begin).lastIndexOf('\n'), indexes.begin);

    if(indentation.indexOf("\n") &lt; 0) {
        indentation = "\n" + indentation;
    }

    var toInject = [this.commentTags.begin];

    injections.forEach(function(file) {
        toInject.push(this.createTag(file));
    }.bind(this));

    var newInject = _.union(originalTags, toInject);

    _.remove(newInject, function(n) {
        return toInject.indexOf(n) &lt; 0;
    });

    toInject.push(this.commentTags.end);


    this.template = this.template.substring(0, indexes.begin) + toInject.join(indentation) + this.template.substr(indexes.end);
    return this.template;

};


/**
 * CaptainHook.prototype.createTag - Create injectable string based on template type and file extension
 * @memberof CaptainHook#
 *
 * @param {string}  file    File to create tag for
 * @return {string}  Created tag
 */
CaptainHook.prototype.createTag = function (file) {
    var extname = path.extname(file).substr(1);
    var injectionTemplate = _.template(this.injectionTemplates[extname]);

    return injectionTemplate({ file: file });
};


/**
 * CaptainHook.prototype.getBlockContents - Get all contents of a comment block
 *
 * @param  {type} commentTags description
 * @return {type}             description
 */
CaptainHook.prototype.getBlockContents = function(commentTags) {
    var indexes = this.getBlockIndexes(commentTags);

    if(!indexes) {
        return false;
    }

    var contents = this.template.substring(indexes.begin + commentTags.begin.length, indexes.end - commentTags.end.length).split(/\s*\n\s*/);
    // remove empty strings from the content array
    contents = _.remove(contents, function(n) {
        return n.length > 0;
    });

    return contents;
};


/**
 * CaptainHook.prototype.getBlockIndexes - Get indexes in template of beginning and ending comments
 *
 * @param  {type} commentTags description
 * @return {type}             description
 */
CaptainHook.prototype.getBlockIndexes = function(commentTags) {
    var beginIndex = this.template.indexOf(commentTags.begin);

    if(beginIndex &lt; 0) {
        return false;
    }

    var endIndex = this.template.indexOf(commentTags.end) + commentTags.end.length;

    return { begin: beginIndex, end: endIndex };
};


/**
 * CaptainHook.prototype.generateCommentTags - Generate comment tags based on template style and a blockID
 *
 * @param  {type} blockID description
 * @return {type}         description
 */
CaptainHook.prototype.generateCommentTags = function(blockID) {
    var compile = _.template(this.commentStyle);
    return {
        begin: compile({ marker: 'begin', type: blockID }),
        end: compile({ marker: 'end', type: blockID })
    };
};

module.exports = CaptainHook;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CaptainHook.html">CaptainHook</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta1</a> on Tue Mar 03 2015 15:45:48 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
